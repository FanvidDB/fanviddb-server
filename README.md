# fanviddb-server

This repository contains the codebase for the fanviddb server.

## Setup

1. Clone this repository. From inside the repository, run:

```
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. Install Postgres and create a database / user to connect to.
3. Create a `.env` file in the repository root that looks like this:

```
DATABASE_URL="postgresql://user:password@localhost/dbname"
AUTH_SECRET_KEY="secret"
EMAIL_TOKEN_SECRET_KEY="secret"
```

4. Run alembic migrations with `alembic upgrade head`

## Running the server

```
uvicorn fanviddb.api:app --reload
```

This will automatically reload the server when your code changes.

## Running tests

```
pytest
```

## Running linters

```
make lint
```

## Autogenerated migrations

For simple migrations, you can automatically generate them with alembic:

```
alembic revision --autogenerate -m "brief description"
```

Once generated, migrations can be applied with `alembic upgrade head`.

## docs.fanviddb.com

The /docs/ folder is used to [generate](https://docs.github.com/en/github/working-with-github-pages/setting-up-a-github-pages-site-with-jekyll) [docs.fanviddb.com](https://docs.fanviddb.com).

### Setup

1. [Install Jekyll](https://jekyllrb.com/docs/installation/) and bundler on your computer. We recommend using rbenv for the installation, but it is not required.
2. Navigate to the `docs/` folder.
3. Run `bundle install`

### Running jekyll

1. Navigate to the `docs/` folder
2. Run `bundle exec jekyll serve`
